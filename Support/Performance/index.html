<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="LibreNMS">
    <link rel="canonical" href="http://docs.librenms.org/Support/Performance/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Performance optimisations - LibreNMS Docs</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../librenms.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Performance optimisations", url: "#performance-optimisations", children: [
              {title: "RRDCached", url: "#rrdcached" },
              {title: "MySQL Optimisation", url: "#mysql-optimisation" },
              {title: "Polling modules", url: "#polling-modules" },
              {title: "SNMP Max Repeaters", url: "#snmp-max-repeaters" },
              {title: "SNMP Max OIDs", url: "#snmp-max-oids" },
              {title: "fping tuning", url: "#fping-tuning" },
              {title: "Optimise poller-wrapper", url: "#optimise-poller-wrapper" },
              {title: "Recursive DNS", url: "#recursive-dns" },
              {title: "Per port polling - experimental", url: "#per-port-polling-experimental" },
              {title: "Web interface", url: "#web-interface" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-79149977-2', 'docs.librenms.org');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    
      <div class="source-links">
      
          <span class="label label-primary"><a href="https://github.com/librenms/librenms//edit/master/doc/Support/Performance.md" target="_blank" style="color:#ffffff"><i class="fa fa-pencil"></i> Edit on GitHub</a></span>
      
      </div>
    

    <h1 id="performance-optimisations">Performance optimisations</h1>
<p>This document will give you some guidance on optimising your setup.</p>
<p>The suggestions are in a rough order of how much impact they will have.</p>
<h3 id="rrdcached">RRDCached</h3>
<p><strong>We absolutely recommend running this, it will save on IO load</strong>. <a href="http://docs.librenms.org/Extensions/RRDCached/">RRDCached</a></p>
<h3 id="mysql-optimisation">MySQL Optimisation</h3>
<p>It's advisable after 24 hours of running MySQL that you run <a href="https://raw.githubusercontent.com/major/MySQLTuner-perl/master/mysqltuner.pl">MySQL Tuner</a>
which will make suggestions on things you can change specific to your setup.</p>
<p>One recommendation we can make is that you set the following in my.cnf under a [mysqld] group: </p>
<pre><code class="bash">innodb_flush_log_at_trx_commit = 0
</code></pre>

<p>You can also set this to 2. This will have the possibility that you could lose up to 1 second on mysql data in the event
MySQL crashes or your server does but it provides an amazing difference in IO use.</p>
<h3 id="polling-modules">Polling modules</h3>
<p>Review the graph of poller module time take under device &gt; graphs &gt; poller to see what modules are consuming poller time.</p>
<p>Disable polling (and discovery) modules that you do not need. You can do this globally in <code>config.php</code> like:</p>
<p>Disable OSPF polling</p>
<pre><code class="php">$config['poller_modules']['ospf'] = false;
</code></pre>

<p>You can disable modules globally then re-enable the module per device or the opposite way. For a list of modules please see
<a href="http://docs.librenms.org/Support/Poller%20Support/">Poller modules</a></p>
<h3 id="snmp-max-repeaters">SNMP Max Repeaters</h3>
<p>We have support for SNMP Max repeaters which can be handy on devices where we poll a lot of ports or bgp sessions for instance and 
where snmpwalk or snmpbulkwalk is used. This needs to be enabled on a per device basis under edit device -&gt; snmp -&gt; Max repeaters.</p>
<p>You can also set this globally with the config option <code>$config['snmp']['max_repeaters'] = X;</code>.</p>
<p>It's advisable to test the time taken to snmpwalk IF-MIB or something similar to work out what the best value is. To do this run the following 
but replace <REPEATERS> with varying numbers from 10 upto around 50. You will also need to set the correct snmp version, hostname and community string:</p>
<p><code>time snmpbulkwalk -v2c -cpublic HOSTNAME -Cr&lt;REPEATERS&gt; -M /opt/librenms/mibs -m IF-MIB IfEntry</code></p>
<blockquote>
<p>NOTE: Do not go blindly setting this value as you can impact polling negatively.</p>
</blockquote>
<h3 id="snmp-max-oids">SNMP Max OIDs</h3>
<p>For sensors polling we now do bulk snmp gets to speed things up. By default this is ten but you can overwrite this per device under 
edit device -&gt; snmp -&gt; Max OIDs.</p>
<p>You can also set this globally with the config option <code>$config['snmp']['max_oid'] = X;</code>.</p>
<blockquote>
<p>NOTE: It is advisable to monitor sensor polling when you change this to ensure you don't set the value too high.</p>
</blockquote>
<h3 id="fping-tuning">fping tuning</h3>
<p>You can change some of the default fping options used globally or per device. The defaults are:</p>
<pre><code class="php">$config['fping_options']['timeout'] = 500;
$config['fping_options']['count']   = 3;
$config['fping_options']['interval'] = 500;
</code></pre>

<p>If your devices are slow to respond then you will need to increase the timeout value and potentially the interval value.
However if your network is stable, you can increase poller performance by dropping the count value to 1 and/or the timeout+millsec value to 200 or 300:</p>
<pre><code class="php">$config['fping_options']['timeout'] = 300;
$config['fping_options']['count']   = 1;
$config['fping_options']['interval'] = 300;
</code></pre>

<p>This will mean that we no longer delay each icmp packet sent (we send 3 in total by default) by 0.5 seconds. With only 1 icmp packet
being sent then we will receive a response quicker. The defaults mean it will take at least 1 second for a response no matter how 
quick the icmp packet is returned.</p>
<h3 id="optimise-poller-wrapper">Optimise poller-wrapper</h3>
<p>The default 16 threads that <code>poller-wrapper.py</code> runs as isn't necessarily the optimal number. A general rule of thumb is 
2 threads per core but we suggest that you play around with lowering / increasing the number until you get the optimal value.
<strong>Note</strong> KEEP in MIND that this doesn't always help, it depends on your system and CPU. So be careful. 
This can be changed by going to the cron job for librenms. Usually in <code>/etc/cron.d/librenms</code> and changing the "16"</p>
<pre><code>*/5  *    * * *   librenms    /opt/librenms/cronic /opt/librenms/poller-wrapper.py 16
</code></pre>

<h3 id="recursive-dns">Recursive DNS</h3>
<p>If your install uses hostnames for devices and you have quite a lot then it's advisable to setup a local recursive dns instance on the 
LibreNMS server. Something like pdns-recursor can be used and then configure <code>/etc/resolv.conf</code> to use 127.0.0.1 for queries.</p>
<h3 id="per-port-polling-experimental">Per port polling - experimental</h3>
<p>By default the polling ports module will walk ifXEntry + some items from ifEntry regardless of the port. So if a port is marked as deleted because you don't want to see them 
or it's disabled then we still collect data. For the most part this is fine as the walks are quite quick. However for devices with a lot of ports and good % of those are 
either deleted or disabled then this approach isn't optimal. So to counter this you can enable 'selected port polling' per device within the edit device -&gt; misc section or by
globally enabling it (<strong>not recommended</strong>): <code>$config['polling']['selected_ports'] = true;</code>. You can also set it for a specific OS: <code>$config['os']['ios']['polling']['selected_ports'] = true;</code>. </p>
<p>Running <code>./scripts/collect-port-polling.php</code> will poll your devices with both full and selective polling, display a table with the difference and optionally enable or disable selected ports polling for devices which would benefit from a change.
Note that it doesn't continously re-evaluate this, it will only be updated when the script is run. There are a number of options:</p>
<pre><code>-h &lt;device id&gt; | &lt;device hostname wildcard&gt;  Poll single device or wildcard hostname
-e &lt;percentage&gt;                              Enable/disable selected ports polling for devices which would benefit &lt;percentage&gt; from a change
</code></pre>

<h3 id="web-interface">Web interface</h3>
<h4 id="http2">HTTP/2</h4>
<p>If you are running https then you should enable http/2 support in whatever web server you use:</p>
<p>For Nginx (1.9.5 and above) change <code>listen 443 ssl;</code> to <code>listen 443 ssl http2;</code> in the Virtualhost config.</p>
<p>For Apache (2.4.17 an above) set <code>Protocols h2 http/1.1</code> in the Virtualhost config.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Discovery Support/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Discovery Support/" class="btn btn-xs btn-link">
        Discovery Support
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Install Validation/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Install Validation/" class="btn btn-xs btn-link">
        Install validation
      </a>
    </div>
    
  </div>


    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>