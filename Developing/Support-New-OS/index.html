<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="LibreNMS">
        <link rel="canonical" href="http://docs.librenms.org/Developing/Support-New-OS/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	    <title>Support New OS - LibreNMS Docs</title>

        <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.6.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/color.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../librenms.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-79149977-2', 'docs.librenms.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">LibreNMS Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li id="dropdown-Installation" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Installing LibreNMS</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Ubuntu-image/">Ubuntu VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/CentOS-image/">CentOS VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Nginx/">Ubuntu 16.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Apache/">Ubuntu 16.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Nginx/">CentOS 7 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Apache/">CentOS 7 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Older Docs</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Migrating-from-Observium/">Migrating from Observium</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-General" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">General <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../General/Acknowledgement/">Acknowledgement</a>
</li>

                        
                            
<li >
    <a href="../../General/Callback-Stats-and-Privacy/">Callback Stats and Privacy</a>
</li>

                        
                            
<li >
    <a href="../../General/Changelog/">Changelog</a>
</li>

                        
                            
<li >
    <a href="../../General/Contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../General/Credits/">Credits</a>
</li>

                        
                            
<li >
    <a href="../../General/Updating/">Updating</a>
</li>

                        
                            
<li >
    <a href="../../General/Releases/">Releases</a>
</li>

                        
                            
<li >
    <a href="../../General/Security/">Security</a>
</li>

                        
                            
<li >
    <a href="../../General/Welcome-to-Observium-users/">Welcome to Observium users</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Extensions" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Extensions <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Extensions/Alerting/">Alerting</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Applications/">Applications</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Authentication/">Authentication</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Auto-Discovery/">Auto Discovery</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Billing-Module/">Billing Module</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Component/">Component</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Dell-OpenManage/">Dell OpenManage</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Device-Groups/">Device Groups</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Distributed-Poller/">Distributed Poller</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Email-Alerting/">Email Alerting</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Globe-Frontpage/">Globe Frontpage</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Graylog/">Graylog</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/IRC-Bot/">IRC Bot</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/IRC-Bot-Extensions/">IRC Bot Extensions</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/InfluxDB/">InfluxDB</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Interface-Description-Parsing/">Interface Description Parsing</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/MIB-based-polling/">MIB based polling</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Memcached/">Memcached</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Network-Map/">Network Map</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/NFSen/">NFSen</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Oxidized/">Oxidized</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Plugin-System/">Plugin System</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Poller-Service/">Poller Service</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Port-Description-Parser/">Port Description Parser</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Proxmox/">Proxmox</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/RRDCached/">RRDCached</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/RRDTune/">RRDTune</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/SNMP-Proxy/">SNMP Proxy</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/SNMP-Trap-Handler/">SNMP Trap Handler</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Services/">Services</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Smokeping/">Smokeping</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Sub-Directory/">Sub Directory</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Syslog/">Syslog</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Two-Factor-Auth/">Two Factor Auth</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/Varnish/">Varnish</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Developing" class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Using-Git/">Using Git</a>
</li>

                        
                            
<li >
    <a href="../Code-Guidelines/">Code Guidelines</a>
</li>

                        
                            
<li >
    <a href="../Style-Guidelines/">Style Guidelines</a>
</li>

                        
                            
<li >
    <a href="../Validating-Code/">Validating Code</a>
</li>

                        
                            
<li >
    <a href="../Code-Structure/">Code Structure</a>
</li>

                        
                            
<li >
    <a href="../Creating-Documentation/">Creating Documentation</a>
</li>

                        
                            
<li class="active">
    <a href="./">Support New OS</a>
</li>

                        
                            
<li >
    <a href="../Dynamic-Config/">Dynamic Config</a>
</li>

                        
                            
<li >
    <a href="../Sensor-State-Support/">Sensor State Support</a>
</li>

                        
                            
<li >
    <a href="../Merging-Pull-Requests/">Merging Pull Requests</a>
</li>

                        
                            
<li >
    <a href="../Creating-Release/">Creating Release</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../API/API-Docs/">API</a>
                    </li>
                
                
                
                    <li id="dropdown-Support" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Support/Configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../../Support/Discovery Support/">Discovery Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/FAQ/">FAQ</a>
</li>

                        
                            
<li >
    <a href="../../Support/Features/">Features</a>
</li>

                        
                            
<li >
    <a href="../../Support/Install Validation/">Install Validation</a>
</li>

                        
                            
<li >
    <a href="../../Support/Performance/">Performance</a>
</li>

                        
                            
<li >
    <a href="../../Support/Poller Support/">Poller Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/SNMP-Configuration-Examples/">SNMP Configuration Examples</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-hidden" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">hidden <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Nginx/">Ubuntu 14.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Apache/">Ubuntu 14.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Lighttpd/">Ubuntu 14.04 (Lighttpd)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-6-Apache-Nginx/">CentOS 6 (Apache/Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(Debian-Ubuntu)/">Installation (Debian Ubuntu)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(RHEL-CentOS)/">Installation (RHEL CentOS)</a>
</li>

                        
                            
<li >
    <a href="../../Support/Support-New-OS/">Support New OS</a>
</li>

                        
                            
<li >
    <a href="../../Extensions/RRDCached-Security/">RRDCached Security</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i>
                        <span class="visible-xs-inline visible-md-inline visible-lg-inline">Search</span>
                    </a>
                </li>
                
                
                    <li>
                        <a href="https://github.com/librenms/librenms">
                            
                                <i class="fa fa-github"></i>
                            
                            <span class="visible-xs-inline visible-lg-inline">GitHub</span>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="row">
            
                
                    <div class="col-md-3">
<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#basic-support-for-a-new-os">BASIC SUPPORT FOR A NEW OS</a></li>
        
    
        <li class="main "><a href="#mib">MIB</a></li>
        
            <li><a href="#new-os-definition">New OS definition</a></li>
        
            <li><a href="#discovery-os">Discovery OS</a></li>
        
            <li><a href="#the-final-check">The final check</a></li>
        
    
        <li class="main "><a href="#full-support-for-a-new-os">Full support for a new OS</a></li>
        
            <li><a href="#mib_1">MIB</a></li>
        
            <li><a href="#new-os-definition_1">New OS definition</a></li>
        
            <li><a href="#discovery-os_1">Discovery OS</a></li>
        
            <li><a href="#polling-os">Polling OS</a></li>
        
            <li><a href="#displaying">Displaying</a></li>
        
            <li><a href="#the-final-check_1">The final check</a></li>
        
    
        <li class="main "><a href="#os-test-units">OS Test units</a></li>
        
    
    </ul>
</div>
</div>
                    <div class="col-md-9" role="main">
<div class="row">
  <div class="source-links col-md-offset-8 col-md-4">

    <a href="https://github.com/librenms/librenms/edit/master/doc/Developing/Support-New-OS.md" target="_blank"><i class="fa fa-pencil"></i> Edit on GitHub</a>

  </div>
</div>


<p>This document will explain how to add basic and full support for a new OS. <strong>Some knowledge in PHP is needed for the full support.</strong></p>
<h4 id="basic-support-for-a-new-os">BASIC SUPPORT FOR A NEW OS</h4>
<h3 id="mib">MIB</h3>
<p>If we have the MIB, we can copy the file into the default directory:</p>
<pre><code class="bash">/opt/librenms/mibs
</code></pre>

<h4 id="new-os-definition">New OS definition</h4>
<p>Let's begin to declare the new OS in LibreNMS. At first we modify the definition file located here:</p>
<pre><code class="bash">includes/definitions.inc.php
</code></pre>

<pre><code class="php">// Pulse Secure OS definition
$os = 'pulse';
$config['os'][$os]['text']             = 'Pulse Secure';
$config['os'][$os]['type']             = 'firewall';
$config['os'][$os]['icon']             = 'junos';
$config['os'][$os]['over'][0]['graph'] = 'device_bits';
$config['os'][$os]['over'][0]['text']  = 'Device Traffic';
$config['os'][$os]['over'][1]['graph'] = 'device_processor';
$config['os'][$os]['over'][1]['text']  = 'CPU Usage';
$config['os'][$os]['over'][2]['graph'] = 'device_mempool';
$config['os'][$os]['over'][2]['text']  = 'Memory Usage';

//The icon described before is the image we have to create and put in the directory html/images/os
</code></pre>

<h4 id="discovery-os">Discovery OS</h4>
<p>We create a new file named as our OS definition and in this directory:</p>
<pre><code class="bash">includes/discovery/os/pulse.inc.php
</code></pre>

<p>This file just sets the $os variable, done by checking the SNMP tree for a particular value that matches the OS you are adding. Typically, this will come from the presence of specific values in sysObjectID or sysDescr, or the existence of a particular enterprise tree.
Look at other files to get help in the code structure.</p>
<pre><code class="php">&lt;?php

if (!$os) {
    if (str_contains($sysDescr, 'Pulse Connect Secure')) {
        $os = 'pulse';
    }
}
</code></pre>

<p>Here is the file location for polling the new OS within a vendor MIB or a standard one:</p>
<pre><code class="bash">includes/polling/os/pulse.inc.php
</code></pre>

<p>This file will usually set the variables for $version, $hardware and $hostname retrieved from an snmp lookup.</p>
<pre><code class="php">&lt;?php

$version = trim(snmp_get($device, &quot;productVersion.0&quot;, &quot;-OQv&quot;, &quot;PULSESECURE-PSG-MIB&quot;),'&quot;');
$hardware = &quot;Juniper &quot; . trim(snmp_get($device, &quot;productName.0&quot;, &quot;-OQv&quot;, &quot;PULSESECURE-PSG-MIB&quot;),'&quot;');
$hostname = trim(snmp_get($device, &quot;sysName.0&quot;, &quot;-OQv&quot;, &quot;SNMPv2-MIB&quot;),'&quot;');
</code></pre>

<p>Quick explanation and examples :</p>
<pre><code class="bash">snmpwalk -v2c -c public -m SNMPv2-MIB -M mibs
//will give the overall OIDs that can be retrieve with this standard MIB. OID on the left side and the result on the right side
//Then we have just to pick the wanted OID and do a check

snmpget -v2c -c public -OUsb -m SNMPv2-MIB -M /opt/librenms/mibs -t 30 HOSTNAME SNMPv2-SMI::mib-2.1.1.0
//sysDescr.0 = STRING: Juniper Networks,Inc,Pulse Connect Secure,VA-DTE,8.1R1 (build 33493)

snmpget -v2c -c public -OUsb -m SNMPv2-MIB -M /opt/librenms/mibs -t 30 HOSTNAME SNMPv2-SMI::mib-2.1.5.0
//sysName.0 = STRING: pulse-secure

//Here the same with the vendor MIB and the specific OID
snmpget -v2c -c public -OUsb -m PULSESECURE-PSG-MIB -M /opt/librenms_old/mibs -t 30 HOSTNAME productName.0
//productName.0 = STRING: &quot;Pulse Connect Secure,VA-DTE&quot;

snmpget -v2c -c public -OUsb -m PULSESECURE-PSG-MIB -M /opt/librenms/mibs -t 30 HOSTNAME productVersion.0
//productVersion.0 = STRING: &quot;8.1R1 (build 33493)&quot;
</code></pre>

<h4 id="the-final-check">The final check</h4>
<p>Discovery</p>
<pre><code class="bash">./discovery.php -h HOSTNAME
</code></pre>

<p>Polling</p>
<pre><code class="bash">./poller.php -h HOSTNAME
</code></pre>

<p>At this step we should see all the values retrieved in LibreNMS.</p>
<h3 id="full-support-for-a-new-os">Full support for a new OS</h3>
<h4 id="mib_1">MIB</h4>
<p>At first we copy the MIB file into the default directory:</p>
<pre><code class="bash">/opt/librenms/mibs
</code></pre>

<p>We are now ready to look at inside the file and find the OID we want to use. <em>For this documentation we'll use Pulse Secure devices.</em></p>
<p>Then we can test it with the snmpget command (hostname must be reachable):</p>
<pre><code class="bash">//for example the OID iveCpuUtil.0:
snmpget -v2c -c public -OUsb -m PULSESECURE-PSG-MIB -M /opt/librenms/mibs -t 30 HOSTNAME iveCpuUtil.0
//quick explanation : snmpget -v2c -c COMMUNITY -OUsb -m MIBFILE -M MIB DIRECTORY HOSTNAME OID

//Result here:
iveCpuUtil.0 = Gauge32: 28
</code></pre>

<h4 id="new-os-definition_1">New OS definition</h4>
<p>Let's begin to declare the new OS in LibreNMS. At first we modify the definition file located here:</p>
<pre><code class="bash">includes/definitions.inc.php
</code></pre>

<pre><code class="php">// Pulse Secure OS definition
$os = 'pulse';
$config['os'][$os]['text']             = 'Pulse Secure';
$config['os'][$os]['type']             = 'firewall';
$config['os'][$os]['icon']             = 'junos';
$config['os'][$os]['over'][0]['graph'] = 'device_bits';
$config['os'][$os]['over'][0]['text']  = 'Device Traffic';
$config['os'][$os]['over'][1]['graph'] = 'device_processor';
$config['os'][$os]['over'][1]['text']  = 'CPU Usage';
$config['os'][$os]['over'][2]['graph'] = 'device_mempool';
$config['os'][$os]['over'][2]['text']  = 'Memory Usage';

//The icon described before is the image we have to create and put in the directory html/images/os

//Don't forget to declare the specific graphs if needed. It will be located near the end of the file.

//Pulse Secure Graphs
$config['graph_types']['device']['pulse_users']['section']         = 'firewall';
$config['graph_types']['device']['pulse_users']['order']           = '0';
$config['graph_types']['device']['pulse_users']['descr']           = 'Active Users';
$config['graph_types']['device']['pulse_sessions']['section']      = 'firewall';
$config['graph_types']['device']['pulse_sessions']['order']        = '0';
$config['graph_types']['device']['pulse_sessions']['descr']        = 'Active Sessions';
</code></pre>

<h4 id="discovery-os_1">Discovery OS</h4>
<p>We create a new file named as our OS definition and in this directory:</p>
<pre><code class="bash">includes/discovery/os/pulse.inc.php
</code></pre>

<p>Look at other files to get help in the code structure. For this example, it can be like this :</p>
<pre><code class="php">// Pulse Secure OS definition
&lt;?php
if (!$os) {
    if (strstr($sysDescr, 'Pulse Connect Secure')) {
        $os = 'pulse';
    }
}
</code></pre>

<p>As we declared Memory and CPU graphs before, we declare the OID in a PHP file :</p>
<p><strong>Memory</strong></p>
<pre><code class="bash">includes/discovery/mempools/pulse.inc.php
</code></pre>

<pre><code class="php">&lt;?php
//
// Hardcoded discovery of Memory usage on Pulse Secure devices.
//
if ($device['os'] == 'pulse') {
    echo 'PULSE-MEMORY-POOL: ';

    $usage = str_replace('&quot;', &quot;&quot;, snmp_get($device, 'PULSESECURE-PSG-MIB::iveMemoryUtil.0', '-OvQ'));

    if (is_numeric($usage)) {
        discover_mempool($valid_mempool, $device, 0, 'pulse-mem', 'Main Memory', '100', null, null);
    }
}
</code></pre>

<p><strong>CPU</strong></p>
<pre><code class="bash">includes/discovery/processors/pulse.inc.php
</code></pre>

<pre><code class="php">&lt;?php
//
// Hardcoded discovery of CPU usage on Pulse Secure devices.
//
if ($device['os'] == 'pulse') {
    echo 'Pulse Secure : ';

    $descr = 'Processor';
    $usage = str_replace('&quot;', &quot;&quot;, snmp_get($device, 'PULSESECURE-PSG-MIB::iveCpuUtil.0', '-OvQ'));

    if (is_numeric($usage)) {
        discover_processor($valid['processor'], $device, 'PULSESECURE-PSG-MIB::iveCpuUtil.0', '0', 'pulse-cpu', $descr,
 '100', $usage, null, null);
    }
}
</code></pre>

<p><em>Please keep in mind that the PHP code is often different for the needs of the devices and the information we retrieve.</em></p>
<h4 id="polling-os">Polling OS</h4>
<p>We will now do the same for the polling process:</p>
<p><strong>Memory</strong></p>
<pre><code class="bash">includes/polling/mempools/pulse-mem.inc.php
</code></pre>

<pre><code class="php">&lt;?php

// Simple hard-coded poller for Pulse Secure
echo 'Pulse Secure MemPool'.'\n';

if ($device['os'] == 'pulse') {
  $perc     = str_replace('&quot;', &quot;&quot;, snmp_get($device, &quot;PULSESECURE-PSG-MIB::iveMemoryUtil.0&quot;, '-OvQ'));
  $memory_available = str_replace('&quot;', &quot;&quot;, snmp_get($device, &quot;UCD-SNMP-MIB::memTotalReal.0&quot;, '-OvQ'));
  $mempool['total'] = $memory_available;

  if (is_numeric($perc)) {
    $mempool['used'] = ($memory_available / 100 * $perc);
    $mempool['free'] = ($memory_available - $mempool['used']);
  }

  echo &quot;PERC &quot; .$perc.&quot;%\n&quot;;
  echo &quot;Avail &quot; .$mempool['total'].&quot;\n&quot;;

}
</code></pre>

<p><strong>CPU</strong></p>
<pre><code class="bash">includes/polling/processors/pulse-cpu.inc.php
</code></pre>

<pre><code class="php">&lt;?php
// Simple hard-coded poller for Pulse Secure
echo 'Pulse Secure CPU Usage';

if ($device['os'] == 'pulse') {
    $usage = str_replace('&quot;', &quot;&quot;, snmp_get($device, 'PULSESECURE-PSG-MIB::iveCpuUtil.0', '-OvQ'));

    if (is_numeric($usage)) {
        $proc = ($usage * 100);
    }
}
</code></pre>

<p>Here is the file location for the specific graphs based on the OID in the vendor MIB:</p>
<pre><code class="bash">includes/polling/os/pulse.inc.php
</code></pre>

<p>We declare two specific graphs for users and sessions numbers. Theses two graphs will be displayed on the firewall section of the graphs tab as it was written in the definition include file.</p>
<pre><code class="php">&lt;?php

$version = trim(snmp_get($device, &quot;productVersion.0&quot;, &quot;-OQv&quot;, &quot;PULSESECURE-PSG-MIB&quot;),'&quot;');
$hardware = &quot;Juniper &quot; . trim(snmp_get($device, &quot;productName.0&quot;, &quot;-OQv&quot;, &quot;PULSESECURE-PSG-MIB&quot;),'&quot;');
$hostname = trim(snmp_get($device, &quot;sysName.0&quot;, &quot;-OQv&quot;, &quot;SNMPv2-MIB&quot;),'&quot;');

$users = snmp_get($device, 'PULSESECURE-PSG-MIB::iveConcurrentUsers.0', '-OQv');

if (is_numeric($users)) {
    $rrd_def = 'DS:users:GAUGE:600:0:U';
    $fields = array(
        'users' =&gt; $users
    )
    $tags = compact('rrd_def');
    data_update($device, 'pulse_users', $tags, $fields);
    $graphs['pulse_users'] = true;
}

$sessions = snmp_get($device, 'PULSESECURE-PSG-MIB::iveConcurrentUsers.0', '-OQv');

if (is_numeric($sessions)) {
    $rrd_def = array(
        'DS:sessions:GAUGE:600:0:U',
    }
    $fields = array(
        'sessions' =&gt; $sessions
    );
    $tags = compact('rrd_def');
    data_update($device, 'pulse_sessions', $tags, $fields);
    $graphs['pulse_sessions'] = true;
}
</code></pre>

<p>We finish in the declaration of the two graph types in the database:</p>
<p>We can do that within a file to share our work and contribute in the development of LibreNMS. :-)</p>
<pre><code class="bash">sql-schema/xxx.sql
//check the file number in GitHub

php includes/sql-schema/update.php
</code></pre>

<p>Or put the SQL commands directly in Mysql or PhpMyadmin for our tests:</p>
<pre><code class="php">INSERT INTO `graph_types`(`graph_type`, `graph_subtype`, `graph_section`, `graph_descr`, `graph_order`) VALUES ('device',  'pulse_users',  'firewall',  'Active Users',  '');
INSERT INTO `graph_types`(`graph_type`, `graph_subtype`, `graph_section`, `graph_descr`, `graph_order`) VALUES ('device',  'pulse_sessions',  'firewall',  'Active Sessions',  '');
</code></pre>

<h4 id="displaying">Displaying</h4>
<p>The specific graphs are not displayed automatically so we need to write the following PHP code:</p>
<p><strong>Pulse Sessions</strong></p>
<pre><code class="bash">html/includes/graphs/device/pulse_sessions.inc.php
</code></pre>

<pre><code class="php">&lt;?php

$rrd_filename = rrd_name($device['hostname'], 'pulse_sessions');

require 'includes/graphs/common.inc.php';

$ds = 'sessions';

$colour_area = '9999cc';
$colour_line = '0000cc';

$colour_area_max = '9999cc';

$graph_max = 1;
$graph_min = 0;

$unit_text = 'Sessions';

require 'includes/graphs/generic_simplex.inc.php';
</code></pre>

<p><strong>Pulse Users</strong></p>
<pre><code class="bash">html/includes/graphs/device/pulse_users.inc.php
</code></pre>

<pre><code class="php">&lt;?php

$rrd_filename = rrd_name($device['hostname'], 'pulse_users');

require 'includes/graphs/common.inc.php';

$ds = 'users';

$colour_area = '9999cc';
$colour_line = '0000cc';

$colour_area_max = '9999cc';

$graph_max = 1;

$unit_text = 'Users';

require 'includes/graphs/generic_simplex.inc.php';
</code></pre>

<h4 id="the-final-check_1">The final check</h4>
<p>Discovery</p>
<pre><code class="bash">./discovery.php -h HOSTNAME
</code></pre>

<p>Polling</p>
<pre><code class="bash">./poller.php -h HOSTNAME
</code></pre>

<p>At this step we should see all the values retrieved in LibreNMS.</p>
<h3 id="os-test-units">OS Test units</h3>
<p>We have a testing unit for new OS', please ensure you add a test for any new OS' or updates to existing OS discovery.</p>
<p>The OS test unit file is located <code>tests/OSDiscoveryTest.php</code>. An example of this is as follows:</p>
<pre><code class="php">    public function testNios()
    {
        $this-&gt;checkOS('nios');
        $this-&gt;checkOS('nios', 'nios-ipam');
    }
</code></pre>

<p>We utilise <a href="http://snmpsim.sourceforge.net/">snmpsim</a> to do unit testing for OS discovery. For this to work you need
to supply an snmprec file. This is pretty simple and using nios as the example again this would look like:</p>
<pre><code>1.3.6.1.2.1.1.1.0|4|Linux 3.14.25 #1 SMP Thu Jun 16 18:19:37 EDT 2016 x86_64
1.3.6.1.2.1.1.2.0|6|1.3.6.1.4.1.7779.1.1402
</code></pre>

<p>During testing LibreNMS will use any info in the snmprec file for snmp calls.  This one provides 
sysDescr (<code>.1.3.6.1.2.1.1.1.0</code>, 4 = Octet String) and sysObjectID (<code>.1.3.6.1.2.1.1.2.0</code>, 6 = Object Identifier),
 which is the minimum that should be provided for new snmprec files.</p>
<p>To look up the numeric OID and type of an string OID with snmptranslate:</p>
<pre><code class="bash">snmptranslate -On -Td SNMPv2-MIB::sysDescr.0
</code></pre>

<p>Common OIDs used in discovery:</p>
<table>
<thead>
<tr>
<th>String OID</th>
<th>Numeric OID</th>
</tr>
</thead>
<tbody>
<tr>
<td>SNMPv2-MIB::sysDescr.0</td>
<td>1.3.6.1.2.1.1.1.0</td>
</tr>
<tr>
<td>SNMPv2-MIB::sysObjectID.0</td>
<td>1.3.6.1.2.1.1.2.0</td>
</tr>
<tr>
<td>ENTITY-MIB::entPhysicalDescr.1</td>
<td>1.3.6.1.2.1.47.1.1.1.1.2.1</td>
</tr>
<tr>
<td>ENTITY-MIB::entPhysicalMfgName.1</td>
<td>1.3.6.1.2.1.47.1.1.1.1.12.1</td>
</tr>
<tr>
<td>SML-MIB::product-Name.0</td>
<td>1.3.6.1.4.1.2.6.182.3.3.1.0</td>
</tr>
</tbody>
</table>
<p>List of SNMP data types:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>OCTET STRING</td>
<td>4</td>
</tr>
<tr>
<td>Integer32</td>
<td>2</td>
</tr>
<tr>
<td>NULL</td>
<td>5</td>
</tr>
<tr>
<td>OBJECT IDENTIFIER</td>
<td>6</td>
</tr>
<tr>
<td>IpAddress</td>
<td>64</td>
</tr>
<tr>
<td>Counter32</td>
<td>65</td>
</tr>
<tr>
<td>Gauge32</td>
<td>66</td>
</tr>
<tr>
<td>TimeTicks</td>
<td>67</td>
</tr>
<tr>
<td>Opaque</td>
<td>68</td>
</tr>
<tr>
<td>Counter64</td>
<td>70</td>
</tr>
</tbody>
</table>
<p>You can run <code>./scripts/pre-commit.php -u</code> to run the unit tests to check your code.
If you would like to run tests locally against a full snmpsim instance, run <code>./scripts/pre-commit.php -u --snmpsim</code>.</p></div>
                
            
            </div>
        </div>

        <footer>
            <div class="container">
                <hr>
                
                <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
            </div>
        </footer>

        <script src="../../js/jquery-1.12.4.min.js"></script>
        <script src="../../js/bootstrap-3.3.7.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
