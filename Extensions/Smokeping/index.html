<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="LibreNMS">
    <link rel="canonical" href="http://docs.librenms.org/Extensions/Smokeping/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Smokeping integration - LibreNMS Docs</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../librenms.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Smokeping integration", url: "#smokeping-integration", children: [
              {title: "Included Smokeping script", url: "#included-smokeping-script" },
              {title: "Standard Smokeping", url: "#standard-smokeping" },
              {title: "Install and integrate Smokeping [Debian/Ubuntu]", url: "#install-and-integrate-smokeping-debianubuntu" },
              {title: "Install Smokeping", url: "#install-smokeping" },
              {title: "LibreNMS integration", url: "#librenms-integration" },
              {title: "Smokeping and RRDCached", url: "#smokeping-and-rrdcached" },
              {title: "Configure LibreNMS", url: "#configure-librenms" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-79149977-2', 'docs.librenms.org');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    
      <div class="source-links">
      
          <span class="label label-primary"><a href="https://github.com/librenms/librenms//edit/master/doc/Extensions/Smokeping.md" target="_blank" style="color:#ffffff"><i class="fa fa-pencil"></i> Edit on GitHub</a></span>
      
      </div>
    

    <h1 id="smokeping-integration">Smokeping integration</h1>
<p>We currently have two ways to use Smokeping with LibreNMS, the first is using the included script generator to generate the config for Smokeping. The
second is to utilise an existing Smokeping setup.</p>
<h3 id="included-smokeping-script">Included Smokeping script</h3>
<p>To use this, please add something similar to your smokeping config file:</p>
<pre><code class="bash">@include /opt/smokeping/etc/librenms.conf
</code></pre>

<p>Then you need to generate the config file (maybe even add a cron to schedule this in and reload smokeping). We've assumed a few locations for smokeping, the config file you want
to call it and where LibreNMS is:</p>
<pre><code class="bash">cd /opt/librenms/scripts/
php ./gen_smokeping.php &gt; /opt/smokeping/etc/librenms.conf
/opt/smokeping/bin/smokeping --reload
</code></pre>

<p>Sample cron:</p>
<pre><code class="bash">15   0    * * * root cd /opt/librenms/scripts &amp;&amp; php ./gen_smokeping.php &gt; /opt/smokeping/etc/librenms.conf &amp;&amp; /opt/smokeping/bin/smokeping --reload &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>

<p>Now configure LibreNMS (make sure you point dir to your smokeping data directory:</p>
<pre><code class="php">$config['smokeping']['dir'] = '/opt/smokeping/data';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['smokeping']['integration'] = true;
</code></pre>

<h3 id="standard-smokeping">Standard Smokeping</h3>
<p>This is quite simple, just point your dir at the smokeping data directory - please be aware that all RRD files need to be within this dir and NOT sub dirs:</p>
<pre><code class="php">$config['smokeping']['dir'] = '/opt/smokeping/data';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['own_hostname']
</code></pre>

<p>You should now see a new tab in your device page called ping.</p>
<h3 id="install-and-integrate-smokeping-debianubuntu">Install and integrate Smokeping [Debian/Ubuntu]</h3>
<blockquote>
<p>This guide assumes you have already <a href="http://docs.librenms.org/Installation/Installing-LibreNMS/">installed librenms</a>, and you installed apache2 in the process. Tested with Ubuntu 14.04 and Apache 2.4.</p>
</blockquote>
<p>Nearly everything we do will require root, and at one point we'll encounter a problem if we just use sudo, so we'll just switch to root at the beginning...</p>
<pre><code class="bash">sudo su -
</code></pre>

<h3 id="install-smokeping">Install Smokeping</h3>
<pre><code class="bash">apt-get install smokeping
</code></pre>

<p>At the end of installation, you may have gotten this error: <code>ERROR: /etc/smokeping/config.d/pathnames, line 1: File '/usr/sbin/sendmail' does not exist</code></p>
<p>If so, just edit smokeping's pathnames.</p>
<pre><code class="bash">nano /etc/smokeping/config.d/pathnames
</code></pre>

<p>Comment out the first line:</p>
<pre><code class="bash">#sendmail = /usr/sbin/sendmail
</code></pre>

<p>Exit and save.</p>
<p>Check if the smokeping config file was created for apache2:</p>
<pre><code class="bash">ls /etc/apache2/conf-available/
</code></pre>

<p>If you don't see <code>smokeping.conf</code> listed, you'll need to create a symlink for it:</p>
<pre><code class="bash">ln -s /etc/smokeping/apache2.conf /etc/apache2/conf-available/smokeping.conf
</code></pre>

<p>Edit the smokeping config so smokeping knows the hostname it's running on:</p>
<pre><code class="bash">nano /etc/smokeping/config.d/General
</code></pre>

<p>Change the <code>cgiurl</code> value to <code>http://yourhost/cgi-bin/smokeping.cgi</code>
Modify any other values you wish, then exit and save.</p>
<h3 id="librenms-integration">LibreNMS integration</h3>
<p>So far this is a relatively normal Smokeping installation; next we'll set up the LibreNMS integration.</p>
<p>Generate the configuration file so Smokeping knows the hosts you have set up for monitoring in LibreNMS.</p>
<pre><code class="bash">cd /opt/librenms/scripts/
(echo &quot;+ LibreNMS&quot;; php ./gen_smokeping.php) &gt; /etc/smokeping/config.d/librenms.conf
</code></pre>

<p>Add a cron job so as you add or remove hosts in librenms they'll get updated with Smokeping.</p>
<pre><code class="bash">crontab -e
</code></pre>

<p>Add the example cron below; it's set to run daily at 02:05</p>
<pre><code class="bash">05 02 * * * root cd /opt/librenms/scripts &amp;&amp; (echo &quot;+ LibreNMS&quot;; php ./gen_smokeping.php) &gt; /etc/smokeping/config.d/librenms.conf &amp;&amp; service smokeping reload &gt;&gt; /dev/null
</code></pre>

<p>Exit and save.</p>
<p>Include <code>librenms.conf</code> in smokeping's config:</p>
<pre><code class="bash">nano /etc/smokeping/config
</code></pre>

<p>Add the following line at the end:</p>
<pre><code class="bash">@include /etc/smokeping/config.d/librenms.conf
</code></pre>

<p>Exit and save.</p>
<h3 id="smokeping-and-rrdcached">Smokeping and RRDCached</h3>
<p>If you are using the standard smokeping data dir (/opt/smokeping/data) then you may need to alter the rrdcached config slightly.</p>
<p>In the standard configuration the -B argument may have been used to restrict rrdcached to read only from a single base dir.</p>
<p>If this is true, when you try an open one of the smokeping graphs from within LibreNMS you will see something like this error at the end of the rrdcached command:</p>
<pre><code class="bash">ERROR: rrdcached: /var/lib/smokeping/&lt;device name&gt;.rrd: Permission denied
</code></pre>

<p>So you will need to either change the dir in which smokeping saves its rrd files to be the same as the main librenms dir or you can remove the -B argument from the rrdcached config to allow it to read from more than one dir.</p>
<p>To remove the -B switch:</p>
<pre><code class="bash">sudo nano /etc/default/rrdcached
</code></pre>

<p>then find:</p>
<pre><code class="bash">BASE_OPTIONS=
</code></pre>

<p>If -B is in the list of arguments delete it.</p>
<h3 id="configure-librenms">Configure LibreNMS</h3>
<pre><code class="bash">nano /opt/librenms/config.php
</code></pre>

<p>Scroll to the bottom, and paste in the following:</p>
<pre><code class="bash">$config['smokeping']['dir'] = '/var/lib/smokeping';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['smokeping']['integration'] = true;
</code></pre>

<p>Exit and save.</p>
<p>Run the following commands:</p>
<pre><code class="bash">a2enconf smokeping
a2enmod cgid
service apache2 restart
service smokeping restart
</code></pre>

<p>Return to your normal user shell</p>
<pre><code class="bash">exit
</code></pre>

<p>Done! You should be able to load the Smokeping web interface at <code>http://yourhost/cgi-bin/smokeping.cgi</code>
In LibreNMS, a Ping tab should also appear.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Weathermap/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Weathermap/" class="btn btn-xs btn-link">
        Weathermap
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../metrics/OpenTSDB/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../metrics/OpenTSDB/" class="btn btn-xs btn-link">
        Enabling support for OpenTSDB.
      </a>
    </div>
    
  </div>


    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>