<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="LibreNMS">
        <link rel="canonical" href="http://docs.librenms.org/Extensions/Smokeping/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	    <title>Smokeping - LibreNMS Docs</title>

        <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.6.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/color.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../librenms.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-79149977-2', 'docs.librenms.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">LibreNMS Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li id="dropdown-Installation" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Installing LibreNMS</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Ubuntu-image/">Ubuntu VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/CentOS-image/">CentOS VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Nginx/">Ubuntu 16.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Apache/">Ubuntu 16.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Nginx/">CentOS 7 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Apache/">CentOS 7 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Older Docs</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Migrating-from-Observium/">Migrating from Observium</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-General" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">General <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../General/Acknowledgement/">Acknowledgement</a>
</li>

                        
                            
<li >
    <a href="../../General/Callback-Stats-and-Privacy/">Callback Stats and Privacy</a>
</li>

                        
                            
<li >
    <a href="../../General/Changelog/">Changelog</a>
</li>

                        
                            
<li >
    <a href="../../General/Contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../General/Credits/">Credits</a>
</li>

                        
                            
<li >
    <a href="../../General/Updating/">Updating</a>
</li>

                        
                            
<li >
    <a href="../../General/Releases/">Releases</a>
</li>

                        
                            
<li >
    <a href="../../General/Security/">Security</a>
</li>

                        
                            
<li >
    <a href="../../General/Welcome-to-Observium-users/">Welcome to Observium users</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Extensions" class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Extensions <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Alerting/">Alerting</a>
</li>

                        
                            
<li >
    <a href="../Applications/">Applications</a>
</li>

                        
                            
<li >
    <a href="../Authentication/">Authentication</a>
</li>

                        
                            
<li >
    <a href="../Auto-Discovery/">Auto Discovery</a>
</li>

                        
                            
<li >
    <a href="../Billing-Module/">Billing Module</a>
</li>

                        
                            
<li >
    <a href="../Component/">Component</a>
</li>

                        
                            
<li >
    <a href="../Dell-OpenManage/">Dell OpenManage</a>
</li>

                        
                            
<li >
    <a href="../Device-Groups/">Device Groups</a>
</li>

                        
                            
<li >
    <a href="../Distributed-Poller/">Distributed Poller</a>
</li>

                        
                            
<li >
    <a href="../Email-Alerting/">Email Alerting</a>
</li>

                        
                            
<li >
    <a href="../Globe-Frontpage/">Globe Frontpage</a>
</li>

                        
                            
<li >
    <a href="../Graylog/">Graylog</a>
</li>

                        
                            
<li >
    <a href="../Graphite/">Graphite</a>
</li>

                        
                            
<li >
    <a href="../IRC-Bot/">IRC Bot</a>
</li>

                        
                            
<li >
    <a href="../IRC-Bot-Extensions/">IRC Bot Extensions</a>
</li>

                        
                            
<li >
    <a href="../InfluxDB/">InfluxDB</a>
</li>

                        
                            
<li >
    <a href="../Interface-Description-Parsing/">Interface Description Parsing</a>
</li>

                        
                            
<li >
    <a href="../MIB-based-polling/">MIB based polling</a>
</li>

                        
                            
<li >
    <a href="../Memcached/">Memcached</a>
</li>

                        
                            
<li >
    <a href="../Network-Map/">Network Map</a>
</li>

                        
                            
<li >
    <a href="../NFSen/">NFSen</a>
</li>

                        
                            
<li >
    <a href="../Oxidized/">Oxidized</a>
</li>

                        
                            
<li >
    <a href="../PeeringDB/">PeeringDB</a>
</li>

                        
                            
<li >
    <a href="../Plugin-System/">Plugin System</a>
</li>

                        
                            
<li >
    <a href="../Poller-Service/">Poller Service</a>
</li>

                        
                            
<li >
    <a href="../Port-Description-Parser/">Port Description Parser</a>
</li>

                        
                            
<li >
    <a href="../Proxmox/">Proxmox</a>
</li>

                        
                            
<li >
    <a href="../RRDCached/">RRDCached</a>
</li>

                        
                            
<li >
    <a href="../RRDTune/">RRDTune</a>
</li>

                        
                            
<li >
    <a href="../SNMP-Proxy/">SNMP Proxy</a>
</li>

                        
                            
<li >
    <a href="../SNMP-Trap-Handler/">SNMP Trap Handler</a>
</li>

                        
                            
<li >
    <a href="../Services/">Services</a>
</li>

                        
                            
<li class="active">
    <a href="./">Smokeping</a>
</li>

                        
                            
<li >
    <a href="../Sub-Directory/">Sub Directory</a>
</li>

                        
                            
<li >
    <a href="../Syslog/">Syslog</a>
</li>

                        
                            
<li >
    <a href="../Two-Factor-Auth/">Two Factor Auth</a>
</li>

                        
                            
<li >
    <a href="../Varnish/">Varnish</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Developing" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Developing/Using-Git/">Using Git</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Code-Guidelines/">Code Guidelines</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Style-Guidelines/">Style Guidelines</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Validating-Code/">Validating Code</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Code-Structure/">Code Structure</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Creating-Documentation/">Creating Documentation</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Support-New-OS/">Adding support for a new OS</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Dynamic-Config/">Dynamic Config</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Sensor-State-Support/">Sensor State Support</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Merging-Pull-Requests/">Merging Pull Requests</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Creating-Release/">Creating Release</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../API/API-Docs/">API</a>
                    </li>
                
                
                
                    <li id="dropdown-Support" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Support/1-Minute-Polling/">1 Minute Polling</a>
</li>

                        
                            
<li >
    <a href="../../Support/Configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../../Support/Discovery Support/">Discovery Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/Example-Hardware-Setup/">Example Hardware Setup</a>
</li>

                        
                            
<li >
    <a href="../../Support/FAQ/">FAQ</a>
</li>

                        
                            
<li >
    <a href="../../Support/Features/">Features</a>
</li>

                        
                            
<li >
    <a href="../../Support/Install Validation/">Install Validation</a>
</li>

                        
                            
<li >
    <a href="../../Support/Performance/">Performance</a>
</li>

                        
                            
<li >
    <a href="../../Support/Poller Support/">Poller Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/Remote-Monitoring-VPN/">Remote Monitoring VPN</a>
</li>

                        
                            
<li >
    <a href="../../Support/SNMP-Configuration-Examples/">SNMP Configuration Examples</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-hidden" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">hidden <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Nginx/">Ubuntu 14.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Apache/">Ubuntu 14.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Lighttpd/">Ubuntu 14.04 (Lighttpd)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-6-Apache-Nginx/">CentOS 6 (Apache/Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(Debian-Ubuntu)/">Installation (Debian Ubuntu)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(RHEL-CentOS)/">Installation (RHEL CentOS)</a>
</li>

                        
                            
<li >
    <a href="../../Support/Support-New-OS/">Support New OS</a>
</li>

                        
                            
<li >
    <a href="../Agent-Setup/">Agent Setup</a>
</li>

                        
                            
<li >
    <a href="../RRDCached-Security/">RRDCached Security</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Initial-Detection/">Initial Detection</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Mem-CPU-Information/">Mem CPU Information</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Test-Units/">Test Units</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Health-Information/">Health Information</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Wireless-Sensors/">Wireless Sensors</a>
</li>

                        
                            
<li >
    <a href="../../Developing/os/Custom-Graphs/">Custom Graphs</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i>
                        <span class="visible-xs-inline visible-md-inline visible-lg-inline">Search</span>
                    </a>
                </li>
                
                
                    <li>
                        <a href="https://github.com/librenms/librenms">
                            
                                <i class="fa fa-github"></i>
                            
                            <span class="visible-xs-inline visible-lg-inline">GitHub</span>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="row">
            
                
                    <div class="col-md-3">
<div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#smokeping-integration">Smokeping integration</a></li>
        
            <li><a href="#included-smokeping-script">Included Smokeping script</a></li>
        
            <li><a href="#standard-smokeping">Standard Smokeping</a></li>
        
            <li><a href="#install-and-integrate-smokeping-debianubuntu">Install and integrate Smokeping [Debian/Ubuntu]</a></li>
        
            <li><a href="#install-smokeping">Install Smokeping</a></li>
        
            <li><a href="#librenms-integration">LibreNMS integration</a></li>
        
            <li><a href="#smokeping-and-rrdcached">Smokeping and RRDCached</a></li>
        
            <li><a href="#configure-librenms">Configure LibreNMS</a></li>
        
    
    </ul>
</div>
</div>
                    <div class="col-md-9" role="main">
<div class="row">
  <div class="source-links col-md-offset-8 col-md-4">

    <a href="https://github.com/librenms/librenms/edit/master/doc/Extensions/Smokeping.md" target="_blank"><i class="fa fa-pencil"></i> Edit on GitHub</a>

  </div>
</div>


<h1 id="smokeping-integration">Smokeping integration</h1>
<p>We currently have two ways to use Smokeping with LibreNMS, the first is using the included script generator to generate the config for Smokeping. The
second is to utilise an existing Smokeping setup.</p>
<h3 id="included-smokeping-script">Included Smokeping script</h3>
<p>To use this, please add something similar to your smokeping config file:</p>
<pre><code class="bash">@include /opt/smokeping/etc/librenms.conf
</code></pre>

<p>Then you need to generate the config file (maybe even add a cron to schedule this in and reload smokeping). We've assumed a few locations for smokeping, the config file you want
to call it and where LibreNMS is:</p>
<pre><code class="bash">cd /opt/librenms/scripts/
php ./gen_smokeping.php &gt; /opt/smokeping/etc/librenms.conf
/opt/smokeping/bin/smokeping --reload
</code></pre>

<p>Sample cron:</p>
<pre><code class="bash">15   0    * * * root cd /opt/librenms/scripts &amp;&amp; php ./gen_smokeping.php &gt; /opt/smokeping/etc/librenms.conf &amp;&amp; /opt/smokeping/bin/smokeping --reload &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>

<p>Now configure LibreNMS (make sure you point dir to your smokeping data directory:</p>
<pre><code class="php">$config['smokeping']['dir'] = '/opt/smokeping/data';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['smokeping']['integration'] = true;
</code></pre>

<h3 id="standard-smokeping">Standard Smokeping</h3>
<p>This is quite simple, just point your dir at the smokeping data directory - please be aware that all RRD files need to be within this dir and NOT sub dirs:</p>
<pre><code class="php">$config['smokeping']['dir'] = '/opt/smokeping/data';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['own_hostname']
</code></pre>

<p>You should now see a new tab in your device page called ping.</p>
<h3 id="install-and-integrate-smokeping-debianubuntu">Install and integrate Smokeping [Debian/Ubuntu]</h3>
<blockquote>
<p>This guide assumes you have already <a href="http://docs.librenms.org/Installation/Installing-LibreNMS/">installed librenms</a>, and you installed apache2 in the process. Tested with Ubuntu 14.04 and Apache 2.4.</p>
</blockquote>
<p>Nearly everything we do will require root, and at one point we'll encounter a problem if we just use sudo, so we'll just switch to root at the beginning...</p>
<pre><code class="bash">sudo su -
</code></pre>

<h3 id="install-smokeping">Install Smokeping</h3>
<pre><code class="bash">apt-get install smokeping
</code></pre>

<p>At the end of installation, you may have gotten this error: <code>ERROR: /etc/smokeping/config.d/pathnames, line 1: File '/usr/sbin/sendmail' does not exist</code></p>
<p>If so, just edit smokeping's pathnames.</p>
<pre><code class="bash">nano /etc/smokeping/config.d/pathnames
</code></pre>

<p>Comment out the first line:</p>
<pre><code class="bash">#sendmail = /usr/sbin/sendmail
</code></pre>

<p>Exit and save.</p>
<p>Check if the smokeping config file was created for apache2:</p>
<pre><code class="bash">ls /etc/apache2/conf-available/
</code></pre>

<p>If you don't see <code>smokeping.conf</code> listed, you'll need to create a symlink for it:</p>
<pre><code class="bash">ln -s /etc/smokeping/apache2.conf /etc/apache2/conf-available/smokeping.conf
</code></pre>

<p>Edit the smokeping config so smokeping knows the hostname it's running on:</p>
<pre><code class="bash">nano /etc/smokeping/config.d/General
</code></pre>

<p>Change the <code>cgiurl</code> value to <code>http://yourhost/cgi-bin/smokeping.cgi</code>
Modify any other values you wish, then exit and save.</p>
<h3 id="librenms-integration">LibreNMS integration</h3>
<p>So far this is a relatively normal Smokeping installation; next we'll set up the LibreNMS integration.</p>
<p>Generate the configuration file so Smokeping knows the hosts you have set up for monitoring in LibreNMS.</p>
<pre><code class="bash">cd /opt/librenms/scripts/
(echo &quot;+ LibreNMS&quot;; php ./gen_smokeping.php) &gt; /etc/smokeping/config.d/librenms.conf
</code></pre>

<p>Add a cron job so as you add or remove hosts in librenms they'll get updated with Smokeping.</p>
<pre><code class="bash">crontab -e
</code></pre>

<p>Add the example cron below; it's set to run daily at 02:05</p>
<pre><code class="bash">05 02 * * * root cd /opt/librenms/scripts &amp;&amp; (echo &quot;+ LibreNMS&quot;; php ./gen_smokeping.php) &gt; /etc/smokeping/config.d/librenms.conf &amp;&amp; service smokeping reload &gt;&gt; /dev/null
</code></pre>

<p>Exit and save.</p>
<p>Include <code>librenms.conf</code> in smokeping's config:</p>
<pre><code class="bash">nano /etc/smokeping/config
</code></pre>

<p>Add the following line at the end:</p>
<pre><code class="bash">@include /etc/smokeping/config.d/librenms.conf
</code></pre>

<p>Exit and save.</p>
<h3 id="smokeping-and-rrdcached">Smokeping and RRDCached</h3>
<p>If you are using the standard smokeping data dir (/opt/smokeping/data) then you may need to alter the rrdcached config slightly.</p>
<p>In the standard configuration the -B argument may have been used to restrict rrdcached to read only from a single base dir.</p>
<p>If this is true, when you try an open one of the smokeping graphs from within LibreNMS you will see something like this error at the end of the rrdcached command:</p>
<pre><code class="bash">ERROR: rrdcached: /var/lib/smokeping/&lt;device name&gt;.rrd: Permission denied
</code></pre>

<p>So you will need to either change the dir in which smokeping saves its rrd files to be the same as the main librenms dir or you can remove the -B argument from the rrdcached config to allow it to read from more than one dir.</p>
<p>To remove the -B switch:</p>
<pre><code class="bash">sudo nano /etc/default/rrdcached
</code></pre>

<p>then find:</p>
<pre><code class="bash">BASE_OPTIONS=
</code></pre>

<p>If -B is in the list of arguments delete it.</p>
<h3 id="configure-librenms">Configure LibreNMS</h3>
<pre><code class="bash">nano /opt/librenms/config.php
</code></pre>

<p>Scroll to the bottom, and paste in the following:</p>
<pre><code class="bash">$config['smokeping']['dir'] = '/var/lib/smokeping';
$config['smokeping']['pings'] = 20;     // should be equal to &quot;pings&quot; in your smokeping config
$config['smokeping']['integration'] = true;
</code></pre>

<p>Exit and save.</p>
<p>Run the following commands:</p>
<pre><code class="bash">a2enconf smokeping
a2enmod cgid
service apache2 restart
service smokeping restart
</code></pre>

<p>Return to your normal user shell</p>
<pre><code class="bash">exit
</code></pre>

<p>Done! You should be able to load the Smokeping web interface at <code>http://yourhost/cgi-bin/smokeping.cgi</code>
In LibreNMS, a Ping tab should also appear.</p></div>
                
            
            </div>
        </div>

        <footer>
            <div class="container">
                <hr>
                
                <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
            </div>
        </footer>

        <script src="../../js/jquery-1.12.4.min.js"></script>
        <script src="../../js/bootstrap-3.3.7.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
