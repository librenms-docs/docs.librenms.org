<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="LibreNMS">
        <link rel="canonical" href="http://docs.librenms.org/Extensions/Distributed-Poller/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Distributed Poller - LibreNMS Docs</title>

        <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.6.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/color.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../librenms.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-79149977-2', 'docs.librenms.org');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">LibreNMS Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li id="dropdown-Installation" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Installing LibreNMS</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Ubuntu-image/">Ubuntu VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/CentOS-image/">CentOS VM Image</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Nginx/">Ubuntu 16.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1604-Apache/">Ubuntu 16.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Nginx/">CentOS 7 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-7-Apache/">CentOS 7 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installing-LibreNMS/">Older Docs</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Migrating-from-Observium/">Migrating from Observium</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-General" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">General <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../General/Acknowledgement/">Acknowledgement</a>
</li>

                        
                            
<li >
    <a href="../../General/Callback-Stats-and-Privacy/">Callback Stats and Privacy</a>
</li>

                        
                            
<li >
    <a href="../../General/Changelog/">Changelog</a>
</li>

                        
                            
<li >
    <a href="../../General/Contributing/">Contributing</a>
</li>

                        
                            
<li >
    <a href="../../General/Credits/">Credits</a>
</li>

                        
                            
<li >
    <a href="../../General/Updating/">Updating</a>
</li>

                        
                            
<li >
    <a href="../../General/Welcome-to-Observium-users/">Welcome to Observium users</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Extensions" class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Extensions <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Alerting/">Alerting</a>
</li>

                        
                            
<li >
    <a href="../Applications/">Applications</a>
</li>

                        
                            
<li >
    <a href="../Authentication/">Authentication</a>
</li>

                        
                            
<li >
    <a href="../Auto-Discovery/">Auto Discovery</a>
</li>

                        
                            
<li >
    <a href="../Billing-Module/">Billing Module</a>
</li>

                        
                            
<li >
    <a href="../Component/">Component</a>
</li>

                        
                            
<li >
    <a href="../Dell-OpenManage/">Dell OpenManage</a>
</li>

                        
                            
<li >
    <a href="../Device-Groups/">Device Groups</a>
</li>

                        
                            
<li class="active">
    <a href="./">Distributed Poller</a>
</li>

                        
                            
<li >
    <a href="../Email-Alerting/">Email Alerting</a>
</li>

                        
                            
<li >
    <a href="../Globe-Frontpage/">Globe Frontpage</a>
</li>

                        
                            
<li >
    <a href="../Graylog/">Graylog</a>
</li>

                        
                            
<li >
    <a href="../IRC-Bot/">IRC Bot</a>
</li>

                        
                            
<li >
    <a href="../IRC-Bot-Extensions/">IRC Bot Extensions</a>
</li>

                        
                            
<li >
    <a href="../InfluxDB/">InfluxDB</a>
</li>

                        
                            
<li >
    <a href="../Interface-Description-Parsing/">Interface Description Parsing</a>
</li>

                        
                            
<li >
    <a href="../MIB-based-polling/">MIB based polling</a>
</li>

                        
                            
<li >
    <a href="../Memcached/">Memcached</a>
</li>

                        
                            
<li >
    <a href="../Network-Map/">Network Map</a>
</li>

                        
                            
<li >
    <a href="../Oxidized/">Oxidized</a>
</li>

                        
                            
<li >
    <a href="../Plugin-System/">Plugin System</a>
</li>

                        
                            
<li >
    <a href="../Poller-Service/">Poller Service</a>
</li>

                        
                            
<li >
    <a href="../Port-Description-Parser/">Port Description Parser</a>
</li>

                        
                            
<li >
    <a href="../Proxmox/">Proxmox</a>
</li>

                        
                            
<li >
    <a href="../RRDCached/">RRDCached</a>
</li>

                        
                            
<li >
    <a href="../RRDTune/">RRDTune</a>
</li>

                        
                            
<li >
    <a href="../SNMP-Proxy/">SNMP Proxy</a>
</li>

                        
                            
<li >
    <a href="../SNMP-Trap-Handler/">SNMP Trap Handler</a>
</li>

                        
                            
<li >
    <a href="../Services/">Services</a>
</li>

                        
                            
<li >
    <a href="../Smokeping/">Smokeping</a>
</li>

                        
                            
<li >
    <a href="../Sub-Directory/">Sub Directory</a>
</li>

                        
                            
<li >
    <a href="../Syslog/">Syslog</a>
</li>

                        
                            
<li >
    <a href="../Two-Factor-Auth/">Two Factor Auth</a>
</li>

                        
                            
<li >
    <a href="../Varnish/">Varnish</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-Developing" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Developing/Code-Guidelines/">Code Guidelines</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Code-Structure/">Code Structure</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Creating-Documentation/">Creating Documentation</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Dynamic-Config/">Dynamic Config</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Sensor-State-Support/">Sensor State Support</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Style-Guidelines/">Style Guidelines</a>
</li>

                        
                            
<li >
    <a href="../../Developing/Using-Git/">Using Git</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../API/API-Docs/">API</a>
                    </li>
                
                
                
                    <li id="dropdown-Support" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Support/Configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../../Support/Discovery Support/">Discovery Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/FAQ/">FAQ</a>
</li>

                        
                            
<li >
    <a href="../../Support/Features/">Features</a>
</li>

                        
                            
<li >
    <a href="../../Support/Install Validation/">Install Validation</a>
</li>

                        
                            
<li >
    <a href="../../Support/Performance/">Performance</a>
</li>

                        
                            
<li >
    <a href="../../Support/Poller Support/">Poller Support</a>
</li>

                        
                            
<li >
    <a href="../../Support/Support-New-OS/">Support New OS</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li id="dropdown-hidden" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">hidden <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Nginx/">Ubuntu 14.04 (Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Apache/">Ubuntu 14.04 (Apache)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-Ubuntu-1404-Lighttpd/">Ubuntu 14.04 (Lighttpd)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-CentOS-6-Apache-Nginx/">CentOS 6 (Apache/Nginx)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(Debian-Ubuntu)/">Installation (Debian Ubuntu)</a>
</li>

                        
                            
<li >
    <a href="../../Installation/Installation-(RHEL-CentOS)/">Installation (RHEL CentOS)</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i>
                        <span class="visible-xs-inline visible-md-inline visible-lg-inline">Search</span>
                    </a>
                </li>
                
                
                    <li>
                        <a href="https://github.com/librenms/librenms">
                            
                                <i class="fa fa-github"></i>
                            
                            <span class="visible-xs-inline visible-lg-inline">GitHub</span>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#distributed-poller">Distributed Poller</a></li>
        
            <li><a href="#requirements">Requirements</a></li>
        
            <li><a href="#example-setup">Example Setup</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">
<div class="source-links">

    <span class="label label-primary">Extensions/Distributed-Poller.md</span>

</div>


<h1 id="distributed-poller">Distributed Poller</h1>
<p>LibreNMS has the ability to distribute polling of devices to other machines.</p>
<p>These machines can be in a different physical location and therefore minimize network latency for devices that are a considerable 
distance away or are behind NAT firewalls.</p>
<p>Devices can be grouped together into a <code>poller_group</code> to pin these devices to a single or a group of designated pollers.</p>
<blockquote>
<p>All pollers need to share their RRD-folder, for example via NFS or a combination of NFS and rrdcached.</p>
</blockquote>
<p>It is a requirement that all pollers can access the central memcached to communicate with each other.</p>
<h3 id="requirements">Requirements</h3>
<blockquote>
<p>These requirements are above the normal requirements for a full LibreNMS install.</p>
</blockquote>
<ul>
<li>rrdtool version 1.4 or above</li>
<li>python-memcached package</li>
<li>a memcached install</li>
<li>a rrdcached install</li>
</ul>
<p>By default, all hosts are shared and have the <code>poller_group = 0</code>. To pin a device to a poller, set it to a value greater than 0 and set the same value in the poller's config with <code>$config['distributed_poller_group']</code>. One can also specify a comma separated string of poller groups in $config['distributed_poller_group'].  The poller will then poll devices from any of the groups listed.  If new devices get added from the poller they will be assigned to the first poller group in the list unless the group is specified when adding the device.</p>
<p>A standard configuration for a distrinuted poller would look like:</p>
<pre><code class="php">// Distributed Poller-Settings
$config['distributed_poller']                            = true;
$config['distributed_poller_name']                       = file_get_contents('/proc/sys/kernel/hostname');
$config['distributed_poller_group']                      = 0;
$config['distributed_poller_memcached_host']             = 'example.net';
$config['distributed_poller_memcached_port']             = '11211';
</code></pre>

<h2 id="example-setup">Example Setup</h2>
<p>Below is an example setup based on a real deployment which at the time of writing covers over 2,500 devices and 50,000 ports. The setup is running within an OpenStack environment with some commodity hardware for remote pollers. Here's a diagram of how you can scale LibreNMS out:</p>
<p><img alt="Example Setup" src="http://docs.librenms.org/img/librenms-distributed-diagram.png" /></p>
<h3 id="architecture">Architecture</h3>
<p>How you setup the distribution is entirely up to you, you can choose to host the majority of the required services on a single virtual machine or server and then a poller to actually query the devices being monitored all the way through to having a dedicated server for each of the individual roles. Below are notes on what you need to consider both from the software layer but also connectivity.</p>
<h4 id="web-api-layer">Web / API Layer</h4>
<p>This is typically Apache but we have setup guides for both Nginx and Lighttpd which should work perfectly fine. There is nothing unique about the role this service is providing except that if you are adding devices from this layer then the web service will need to be able to connect to the end device via SNMP and perform an ICMP test.</p>
<p>It is advisable to run RRDCached within this setup so that you don't need to share the rrd folder via a remote file share such as NFS. The web service can then generate rrd graphs via RRDCached. If RRDCached isn't an option then you can mount the rrd directory to read the RRD files directly.</p>
<h4 id="database-server">Database Server</h4>
<p>MySQL / MariaDB - At the moment these are the only database servers that are supported, work is being done to ensure MySQL Strict mode is also supported but this should be considered to be incomplete still and therefor disabled.</p>
<p>The pollers, web and API layers should all be able to access the database server directly.</p>
<h4 id="rrd-storage">RRD Storage</h4>
<p>Central storage should be provided so all RRD files can be read from and written to in one location. As suggested above, it's recommended that RRD Cached is configured and used.</p>
<p>For this example, we are running RRDCached to allow all pollers and web/api servers to read/write to the rrd files with the rrd directory also exported by NFS for simple access and maintenance.</p>
<h4 id="memcache">Memcache</h4>
<p>Memcache is required for the distributed pollers to be able to register to a central location and record what devices are polled. Memcache can run from any of the servers so long as it is accessible by all pollers.</p>
<h4 id="pollers">Pollers</h4>
<p>Pollers can be installed and run from anywhere, the only requirements are:</p>
<p>They can access the Memcache instance
They can create RRD files via some method such as a shared filesystem
They can access the MySQL server</p>
<p>You can either assign pollers into groups and set a poller group against certain devices, this will mean that those devices will only be processed by certain pollers (default poller group is 0) or you can assign all pollers to the default poller group for them to process any and all devices.</p>
<p>This will provide the ability to have a single poller behind a NAT firewall monitor internal devices and report back to your central system. You will then be able to monitor those devices from the Web UI as normal.</p>
<p>Another benefit to this is that you can provide N+x pollers, i.e if you know that you require three pollers to process all devices within 300 seconds then adding a 4th poller will mean that should any one single poller fail then the remaining three will complete polling in time. You could also use this to take a poller out of service for maintenance, i.e OS updates and software updates.</p>
<p>It is extremely advisable to either run a central recursive dns server such as pdns-recursor and have all of your pollers use this or install a recursive dns server on each poller - the volume of DNS requests on large installs can be significant and will slow polling down enough to cause issues with a large number of devices.</p>
<h4 id="discovery">Discovery</h4>
<p>It's not necessary to run discovery services on all pollers. In fact, you should only run one discovery process per poller group. Designate a single poller to run discovery (or a separate server if required).</p>
<h4 id="config-sample">Config sample</h4>
<p>The following config is taken from a live setup which consists of a Web server, DB server, RRDCached server and 3 pollers.</p>
<p>Web Server:
Running Apache and an install of LibreNMS in /opt/librenms
 - config.php
<pre><code class="php">$config['distributed_poller'] = true;
$config['rrdcached']    = &quot;example.com:42217&quot;;
</code></pre></p>
<p>Database Server:
Running Memcache and MariaDB
 - Memcache</p>
<p>Ubuntu (/etc/memcached.conf)
<pre><code class="conf">-d
-m 64
-p 11211
-u memcache
-l ip.ip.ip.ip
</code></pre></p>
<p>RRDCached Server:
Running RRDCached
  - RRDCached</p>
<p>Ubuntu (/etc/default/rrdcached)
<pre><code class="conf">OPTS=&quot;-l 0:42217&quot;
OPTS=&quot;$OPTS -j /var/lib/rrdcached/journal/ -F&quot;
OPTS=&quot;$OPTS -b /opt/librenms/rrd -B&quot;
OPTS=&quot;$OPTS -w 1800 -z 900&quot;
</code></pre></p>
<p>Poller 1:
Running an install of LibreNMS in /opt/librenms</p>
<p><code>config.php</code>
<pre><code class="php">$config['distributed_poller_name']           = file_get_contents('/etc/hostname');
$config['distributed_poller_group']          = '0';
$config['distributed_poller_memcached_host'] = &quot;example.com&quot;;
$config['distributed_poller_memcached_port'] = 11211;
$config['distributed_poller_host']           = &quot;example.com&quot;;
$config['distributed_poller_port']           = 11211;
$config['distributed_poller']                = true;
$config['rrdcached']                         = &quot;example.com:42217&quot;;
$config['update']                            = 0;
</code></pre></p>
<p><code>/etc/cron.d/librenms</code>
Runs discovery and polling for group 0, daily.sh to deal with notifications and DB cleanup and alerts.
<pre><code class="conf">33  */6 * * * librenms /opt/librenms/discovery.php -h all &gt;&gt; /dev/null 2&gt;&amp;1
*/5 *   * * * librenms /opt/librenms/discovery.php -h new &gt;&gt; /dev/null 2&gt;&amp;1
*/5 *   * * * librenms /opt/librenms/poller-wrapper.py 24 &gt;&gt; /opt/librenms/logs/wrapper.log
15  0   * * * librenms /opt/librenms/daily.sh &gt;&gt; /dev/null 2&gt;&amp;1
*   *   * * * librenms /opt/librenms/alerts.php &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre></p>
<p>Poller 2:
Running an install of LibreNMS in /opt/librenms</p>
<p><code>config.php</code>
<pre><code class="php">$config['distributed_poller_name']           = file_get_contents('/etc/hostname');
$config['distributed_poller_group']          = '0';
$config['distributed_poller_memcached_host'] = &quot;example.com&quot;;
$config['distributed_poller_memcached_port'] = 11211;
$config['distributed_poller_host']           = &quot;example.com&quot;;
$config['distributed_poller_port']           = 11211;
$config['distributed_poller']                = true;
$config['rrdcached']                         = &quot;example.com:42217&quot;;
$config['update']                            = 0;
</code></pre></p>
<p><code>/etc/cron.d/librenms</code>
Runs billing as well as polling for group 0.
<pre><code class="conf">*/5 * * * * librenms /opt/librenms/poller-wrapper.py 24 &gt;&gt; /opt/librenms/logs/wrapper.log
*/5 * * * * librenms /opt/librenms/poll-billing.php &gt;&gt; /dev/null 2&gt;&amp;1
01  * * * * librenms /opt/librenms/billing-calculate.php &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre></p>
<p>Poller 3:
Running an install of LibreNMS in /opt/librenms</p>
<p><code>config.php</code>
<pre><code class="php">$config['distributed_poller_name']           = file_get_contents('/etc/hostname');
$config['distributed_poller_group']          = '2,3';
$config['distributed_poller_memcached_host'] = &quot;example.com&quot;;
$config['distributed_poller_memcached_port'] = 11211;
$config['distributed_poller_host']           = &quot;example.com&quot;;
$config['distributed_poller_port']           = 11211;
$config['distributed_poller']                = true;
$config['rrdcached']                         = &quot;example.com:42217&quot;;
$config['update']                            = 0;
</code></pre></p>
<p><code>/etc/cron.d/librenms</code>
Runs discovery and polling for groups 2 and 3.
<pre><code class="conf">33  */6 * * * librenms /opt/librenms/discovery.php -h all &gt;&gt; /dev/null 2&gt;&amp;1
*/5 *   * * * librenms /opt/librenms/discovery.php -h new &gt;&gt; /dev/null 2&gt;&amp;1
*/5 *   * * * librenms /opt/librenms/poller-wrapper.py 16 &gt;&gt; /opt/librenms/logs/wrapper.log
</code></pre></p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.12.4.min.js"></script>
        <script src="../../js/bootstrap-3.3.7.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
